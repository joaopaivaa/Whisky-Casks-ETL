# Loads the rvest, stringr, dplyr, glue and purrr libraries
suppressWarnings({
suppressPackageStartupMessages({
library(rvest)
library(stringr)
library(dplyr)
library(glue)
library(purrr)
library(lubridate)
})
})
# Language: us-english
Sys.setlocale("LC_ALL", "en_US.UTF-8")
setwd("C:\\Users\\joaov\\Documents\\Whisky Casks ETL")
# Loads the auction page
first_page <- read_html('https://www.whiskyhammer.com/auction/past/si-Cask/?sortby=end-time')
first_page
library(rvest)
library(httr)
url <- "https://www.whiskyhammer.com/auction/past/si-Cask/?sortby=end-time"
page <- GET(
url,
add_headers(
`User-Agent` = "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",
`Accept-Language` = "en-US,en;q=0.9",
`Referer` = "https://www.whiskyhammer.com/"
)
)
first_page <- read_html(content(page, "text", encoding = "UTF-8"))
first_page
search_page %>% html_nodes('div.itemsList')
search_page <- read_html(content(page, "text", encoding = "UTF-8"))
search_page %>% html_nodes('div.itemsList')
search_page
search_page[2]
library(chromote)
library(rvest)
b <- ChromoteSession$new()
b$Page$navigate(
"https://www.whiskyhammer.com/auction/past/si-Cask/?sortby=end-time"
)
# espera o Cloudflare resolver o desafio
Sys.sleep(6)
html <- b$get_html()
first_page <- read_html(html)
html <- b$get_html()
first_page <- read_html(html)
res <- b$Runtime$evaluate(
expression = "document.documentElement.outerHTML"
)
html <- res$result$value
first_page <- read_html(html)
first_page
search_page <- read_html(html)
search_page %>% html_nodes('itemsList')
search_page %>% html_nodes('div.itemsList')
search_page %>%
html_element("body") %>%
html_text()
# Loads the rvest, stringr, dplyr, glue and purrr libraries
suppressWarnings({
suppressPackageStartupMessages({
library(rvest)
library(httr)
library(stringr)
library(dplyr)
library(glue)
library(purrr)
library(lubridate)
})
})
# Language: us-english
Sys.setlocale("LC_ALL", "en_US.UTF-8")
setwd("C:\\Users\\joaov\\Documents\\Whisky Casks ETL")
search_page <- read_html("whiskyhammer_casks.html")
search_page
search_page %>% html_nodes('div.itemsList')
search_page <- read_html("whiskyhammer_casks.html")
search_page %>% html_nodes('div.itemsList')
lots_section <- search_page %>% html_nodes('div.itemsList')
search_page %>% html_nodes('div.itemsList.item')
search_page %>% html_nodes('div.itemsList.Item')
search_page %>% html_nodes('div.itemsList') %>% html_nodes('div.item')
search_page <- read_html("whiskyhammer_casks.html")
lots_section <- search_page %>% html_nodes('div.itemsList') %>% html_nodes('div.item')
lots_section
# Loads the rvest, stringr, dplyr, glue and purrr libraries
suppressWarnings({
suppressPackageStartupMessages({
library(rvest)
library(httr)
library(stringr)
library(dplyr)
library(glue)
library(purrr)
library(lubridate)
})
})
# Language: us-english
Sys.setlocale("LC_ALL", "en_US.UTF-8")
setwd("C:\\Users\\joaov\\Documents\\Whisky Casks ETL")
search_page <- read_html("whiskyhammer_casks.html")
search_page %>% html_nodes('div.itemsList') %>% html_nodes('div.item')
lots_section <- search_page %>% html_nodes('div.itemsList') %>% html_nodes('div.item')
length(lots_section)
search_page <- read_html("https://www.whiskyhammer.com/item/226192/Inchgower/Inchgower---2011-Barrique-22007--Held-in-Bond.html")
lot <- lot_section[1]
lot <- lots_section[1]
lot %>% html_nodes('a.itemTitle')
lot %>% html_nodes('a.itemTitle.span')
lot %>% html_nodes('a.itemTitle') %>% html_text()
lot %>% html_nodes('a.itemTitle') %>% html_attr('href')
lot %>% html_nodes('div.itemPriceWrap')
lot %>% html_nodes('div.itemPriceWrap.span.current')
lot %>% html_nodes('div.itemPriceWrap span.current')
lot %>% html_nodes('div.itemPriceWrap span.current') %>% html_text()
lot_auction_date <- lot %>% html_nodes('div.itemPriceWrap span.current') %>% html_text() %>% str_replace('Sold', '') %>% trimws()
lot_auction_date
lot_price <- lot %>% html_nodes('div.itemPriceWrap span.itemPriceWrap span.multiprice span.GBP.show')
lot_price
lot %>% html_nodes('div.itemPriceWrap span.itemPriceWrap span.multiprice')
lot %>% html_nodes('div.itemPriceWrap span.itemPriceWrap')
lot %>% html_nodes('div.itemPriceWrap span.priceStandard span.multiprice span.GBP.show')
lot_price <- lot %>% html_nodes('div.itemPriceWrap span.priceStandard span.multiprice span.GBP.show') %>% html_text() %>% str_replace('£', '') %>% trimws()
lot_price
lot_price <- lot %>% html_nodes('div.itemPriceWrap span.priceStandard span.multiprice span.GBP.show') %>% html_text() %>% str_replace('£', '') %>% str_replace(',', '') %>% trimws()
lot_price
lot %>% html_nodes('div.itemImageWrap')
lot %>% html_nodes('div.itemImageWrap a')
lot %>% html_nodes('div.itemImageWrap a img')
lot %>% html_nodes('div.itemImageWrap a img.js_lazy.entered.loaded')
lot %>% html_nodes('div.itemImageWrap a img.js_lazy.entered.loaded') %>% html_attr('src')
lot %>% html_nodes('div.itemImageWrap img.js_lazy.entered.loaded')
lot %>% html_nodes('div.itemImageWrap a img.js_lazy.entered.loaded') %>% html_attr('src')
lot %>% html_nodes('div.itemImageWrap a img.js_lazy.entered.loaded') %>% html_attr('src') %>% str_replace('./whiskyhammer_casks_files/', '')
lot_image <- lot %>% html_nodes('div.itemImageWrap a img.js_lazy.entered.loaded') %>% html_attr('src') %>% str_replace('./whiskyhammer_casks_files/', '') %>% paste0('https://www.whiskyhammer.com/uploads/images/products/newthumbs/', .)
lot_image
# Loads the rvest, stringr, dplyr, glue and purrr libraries
suppressWarnings({
suppressPackageStartupMessages({
library(rvest)
library(httr)
library(stringr)
library(dplyr)
library(glue)
library(purrr)
library(lubridate)
})
})
# Language: us-english
Sys.setlocale("LC_ALL", "en_US.UTF-8")
setwd("C:\\Users\\joaov\\Documents\\Whisky Casks ETL")
search_page <- read_html("whiskyhammer_casks.html")
lots_section <- search_page %>% html_nodes('div.itemsList') %>% html_nodes('div.item')
lots_df <- data.frame()
for (lot in lots_section) {
lot_title <- lot %>% html_nodes('a.itemTitle') %>% html_text()
lot_url <- lot %>% html_nodes('a.itemTitle') %>% html_attr('href')
lot_auction_date <- lot %>% html_nodes('div.itemPriceWrap span.current') %>% html_text() %>% str_replace('Sold', '') %>% trimws()
lot_price <- lot %>% html_nodes('div.itemPriceWrap span.priceStandard span.multiprice span.GBP.show') %>% html_text() %>% str_replace('£', '') %>% str_replace(',', '') %>% trimws()
lot_image <- lot %>% html_nodes('div.itemImageWrap a img.js_lazy.entered.loaded') %>% html_attr('src') %>% str_replace('./whiskyhammer_casks_files/', '') %>% paste0('https://www.whiskyhammer.com/uploads/images/products/newthumbs/', .)
lot_df <- data.frame(lot_title = lot_title,
lot_url = lot_url,
lot_auction_date = lot_auction_date,
lot_price = lot_price,
lot_image = lot_image)
lots_df <- bind_rows(lots_df, lot_df)
}
setwd("C:\\Users\\joaov\\Documents\\Whisky Casks ETL\\bronze")
write.csv2(lots_df, 'Whisky Hammer - Casks Database.csv')
View(lots_df)
